generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Category {
  masculino
  femenino
}

enum TournamentStatus {
  active
  upcoming
  finished
}

enum TournamentFormat {
  round_robin
  knockout
  group_stage
}

enum TeamStatus {
  pending
  approved
  rejected
}

enum MatchStatus {
  scheduled
  finished
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  firstName String   @default("")
  lastName  String   @default("")
  isAdmin   Boolean  @default(false)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Tournament {
  id                   Int              @id @default(autoincrement())
  name                 String
  code                 String           @unique
  category             Category
  logo                 String?
  status               TournamentStatus @default(active)
  description          String?
  startDate            DateTime?
  endDate              DateTime?
  registrationDeadline DateTime?
  maxTeams             Int              @default(16)
  format               TournamentFormat @default(round_robin)
  location             String?
  prizePool            String?
  createdAt            DateTime         @default(now())
  updatedAt            DateTime         @updatedAt

  teams   Team[]
  matches Match[]
  phases  Phase[]
}

model Team {
  id            Int        @id @default(autoincrement())
  name          String
  logo          String?
  tournamentId  Int
  contactPerson String
  contactNumber String
  status        TeamStatus @default(pending)
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt

  tournament    Tournament      @relation(fields: [tournamentId], references: [id])
  players       Player[]
  homeMatches   Match[]         @relation("homeTeam")
  awayMatches   Match[]         @relation("awayTeam")
  groupStanding GroupStanding[] // Relaci√≥n con GroupStanding

  @@index([tournamentId])
}

model Player {
  id        Int      @id @default(autoincrement())
  teamId    Int
  name      String
  lastName  String
  cedula    String
  photo     String?
  createdAt DateTime @default(now())

  team Team @relation(fields: [teamId], references: [id])

  @@unique([cedula, teamId]) // igual que unique_together en Django
}

model Match {
  id           Int         @id @default(autoincrement())
  tournamentId Int
  phase        String
  venue        String?
  date         DateTime?
  time         String?
  round        Int?
  group        String?
  homeTeamId   Int?
  awayTeamId   Int?
  homeScore    Int?
  awayScore    Int?
  goals        String?
  fouls        String?
  status       MatchStatus @default(scheduled)
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt

  tournament Tournament @relation(fields: [tournamentId], references: [id])
  homeTeam   Team?      @relation("homeTeam", fields: [homeTeamId], references: [id])
  awayTeam   Team?      @relation("awayTeam", fields: [awayTeamId], references: [id])

  @@index([tournamentId])
  @@index([homeTeamId])
  @@index([awayTeamId])
}

model GroupStanding {
  id           Int @id @default(autoincrement())
  teamId       Int
  phaseId      Int
  played       Int @default(0)
  wins         Int @default(0)
  draws        Int @default(0)
  losses       Int @default(0)
  goalsFor     Int @default(0)
  goalsAgainst Int @default(0)
  goalDiff     Int @default(0)
  points       Int @default(0)

  team  Team  @relation(fields: [teamId], references: [id])
  phase Phase @relation(fields: [phaseId], references: [id])

  @@index([teamId])
  @@index([phaseId])
}

enum PhaseType {
  round_robin
  group_stage
  round_of_16
  quarterfinals
  semifinals
  final
}

model Phase {
  id           Int       @id @default(autoincrement())
  name         String
  description  String?
  type         PhaseType
  order        Int       @default(1)
  tournamentId Int
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  tournament     Tournament      @relation(fields: [tournamentId], references: [id])
  groupStandings GroupStanding[]

  @@index([tournamentId])
}
